{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<!-- Page Heading -->
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            Categories <small>Manage</small>
        </h1>
        <ol class="breadcrumb">
            <li class="active">
                <i class="fa fa-dashboard"></i> Feedback
            </li>
        </ol>
    </div>
</div>

<!-- <div class="container"> -->

  {% for category in main_categories %}
  <div class="category-main">
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3> 
          <a data-toggle="modal" data-target="#edit_category_{{category.id}}"
          role="button"> {{category.name}}
          </a>
        <a href="#" data-href="{% url "delete-category" category.id %}" data-toggle="modal" data-target="#confirm-delete" data-id="{{category.name}}" value="Delete" class="float-right-button deletecategory"><span class="fa fa-minus red-icon"></span></a>          
        </h3>

      </div>
      <div class="panel-body">
      {% with category.id|get_subcategories as subcategories %}
        <h4> Subcategories
            <a class="addsubcategory" data-toggle="modal" data-target="#createSubCategory_{{category.id}}" role="button"><span class="fa fa-plus green-icon"></span></a>       
          </h4>
        {% if subcategories %}
        <ul>
          {% for subcategory in subcategories %}
            <li>
              <a data-toggle="modal" data-target="#edit_subcategory_{{subcategory.id}}"
                role="button"> {{subcategory.name }} </a>

              <a href="#" data-href="{% url "delete-subcategory" subcategory.id %}" data-toggle="modal" data-target="#confirm-delete" data-id="{{subcategory.name}}" value="Delete" class="deletecategory"><span class="fa fa-remove red-icon"></span></a>  

              {% with subcategory.id|get_feedback_pieces as feedback_collection %}
              <h4> Feedback Pieces | {{subcategory.name}} | <a class="addcommonfeedback" data-toggle="modal" data-target="#createCommonFeedback_{{subcategory.id}}" role="button"><span class="fa fa-plus green-icon"></span></a></h4>

              {% if feedback_collection %}
               <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Observation Type</th>
                                <th>Observation</th>
                                <th>Feedback</th>
                                <th>Feedback Explanation</th>
                                <th>Edit </th>
                                <th>Remove</th>
                            </tr>
                        </thead>
                        <tbody> 

            <!--   <ul> -->
             <!--    <hr> -->
                {% for feedback_piece in feedback_collection %}
                <tr>
                  <td><h4>{{forloop.counter}}</h4>
                 </td>
               <!--    <li> -->
                    <td>
                      {% if feedback_piece.observation.observation_type == True %}
                      Positive
                      {% elif feedback_piece.observation.observation_type == False %} 
                      Negative
                      {% else %}
                        Neutral
                      {% endif %}
                   </td>             
               <td>
                    <p>{{feedback_piece.observation.observation}} </p>
                  </td>

                    <td><p>{{feedback_piece.feedback.feedback}}</p></td>
                    <td><p>{{feedback_piece.feedback_explanation.feedback_explanation}}</p></td>
                  <!--   <hr> -->
                 <!--  </li> -->
                 <td>
                  <a data-toggle="modal" data-target="#edit_feedbackpiece_{{feedback_piece.id}}" role="button"><span class="fa fa-edit"></span></a> 
                </td>
                <td>
                  <a href="#" data-href="{% url "delete-feedback-piece" feedback_piece.id %}" data-toggle="modal" data-target="#confirm-delete-feedbackpiece" data-id="{{feedback_piece.id}}" value="Delete" class="deletecategory"><span class="fa fa-minus red-icon"></span></a></td>
                   {% include '_edit_feedback_piece_partial.html' %}
                </tr>
                {% endfor %}
         <!--      </ul> -->
            </tbody>
                    </table>
                </div>        
                {% endif %}     
              {% endwith %}
         <!--    </li> -->

            {% include '_edit_subcategory_partial.html' %}   
            {% include '_create_common_feedback_partial.html' %}

          {% endfor %}
       <!--  </ul> -->
        {% else %}
          <span> No subcategories found for this category. </span>
        {% endif %}
      {% endwith %}

      {% include '_create_subcategory_partial.html' %}

   
      {% include '_edit_main_category_partial.html' %}

    </div>
  </div>

  {% endfor %}

<!-- </div> -->



{% if user.is_superuser %}
<a class="btn btn-primary" data-toggle="modal" data-target="#createMainCategory" role="button"><span class="fa fa-group"></span> Create Main Category</a>


<div class="modal fade" id="createMainCategory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Create Main Category</h4>
      </div>
          <div class="modal-body">
            <h5> Category: </h5>
            <form class="form-horizontal" id="createCategoryForm" action="{% url "category-create-main" %}" method="POST">{% csrf_token %}        
               <div class="form-group padding-lr">
            <label for="name">Name: </label>
<input name="name" type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter main category name here"></input>              

          </div>
           <div class="form-group padding-lr">
            <label for="description">Description: </label>
          <textarea name="description" type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter main category description/notes here"></textarea>            
          </div>

          </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <input type="submit" value="Create" class="btn btn-primary"/>      
        </form>
      </div>
    </div>
  </div>
</div>    
</div>  
{% endif %}
<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Delete Category
            </div>
            <div class="modal-body">
                <span> Are you sure you want to delete the category: </span>
                 <b><span type="text" name="categoryName" id="categoryName"></span></b>
                 <span> ? </span>

            </div>
                 <div class="alert alert-warning" role="alert">
                  <span style="color: darkyellow;" class="fa fa-warning"></span>Warning! If this is a main category, all of its subcategories will also be deleted.
                  </div>            
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a class="btn btn-danger btn-ok">Delete</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="confirm-delete-feedbackpiece" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Delete Feedback Piece
            </div>
            <div class="modal-body">
                <span> Are you sure you want to delete the feedback piece: </span>
                 <b><span type="text" name="categoryName" id="categoryName"></span></b>
                 <span> ? </span>

            </div>
                 <div class="alert alert-warning" role="alert">
                  <span style="color: darkyellow;" class="fa fa-warning"></span>Warning! You will not be able to recover this feedback piece.
                  </div>            
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a class="btn btn-danger btn-ok">Delete</a>
            </div>
        </div>
    </div>
</div>


{% endblock %}